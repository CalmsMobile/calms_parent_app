import 'package:flutter/material.dart';

class Stores extends StatefulWidget {
  const Stores();

  List<Map<dynamic, dynamic>> getStoreList() {
    return [
      {
        "category": "Stationery",
        "item_name": "Color Box",
        "inventory_code": "S1011",
        "description":
            "46 PCS Color Set has a lot of fun features to keep your baby engaged. It has 42 pieces It contain 12 water color, 6 sketch color, a sharpner, an eraser, 10 crayons color, 8 oil pastel colors, a glue, a paper clip and a box. Very nice product for your kid It improves creative power of your dear ones. Improves visual skills, creative skills and coordination skills of your child Designed keeping safety of your child on priority basis Always choose Happiesta for your kids Happiness",
        "is_dress": 1,
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [
          "http://124.217.235.107:2008/Handler/ImagePathHandler.ashx?ImagePath=StoreItems/b6fa-e4c2-2021-11-25-11-32-18-810/71-zpNFAyTL._SL1080_.jpg&Default=60&PROUrl=http://124.217.235.107:2008/&StoreageUrl=http://124.217.235.107:2008/FS/",
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg"
        ],
        "colors": ["White", "Black", "Red", "Blue"],
        "size": ["S", "M", "L", "XL", "XXL"],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
      {
        "category": "Stationery",
        "item_name": "student-plastic-id-card-holder-500x500",
        "inventory_code": "S1011",
        "description": "student-plastic-id-card-holder-500x500",
        "is_dress": "0",
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg",
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg"
        ],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
      {
        "category": "Stationery",
        "item_name": "student-plastic-id-card-holder-500x500",
        "inventory_code": "S1011",
        "description": "student-plastic-id-card-holder-500x500",
        "is_dress": "0",
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg",
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg"
        ],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
      {
        "category": "Stationery",
        "item_name": "student-plastic-id-card-holder-500x500",
        "inventory_code": "S1011",
        "description": "student-plastic-id-card-holder-500x500",
        "is_dress": "0",
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg",
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg"
        ],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
      {
        "category": "Stationery",
        "item_name": "student-plastic-id-card-holder-500x500",
        "inventory_code": "S1011",
        "description": "student-plastic-id-card-holder-500x500",
        "is_dress": "0",
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg",
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg"
        ],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
      {
        "category": "Stationery",
        "item_name": "student-plastic-id-card-holder-500x500",
        "inventory_code": "S1011",
        "description": "student-plastic-id-card-holder-500x500",
        "is_dress": "0",
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg",
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg"
        ],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
      {
        "category": "Stationery",
        "item_name": "student-plastic-id-card-holder-500x500",
        "inventory_code": "S1011",
        "description": "student-plastic-id-card-holder-500x500",
        "is_dress": "0",
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg",
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg"
        ],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
      {
        "category": "Stationery",
        "item_name": "student-plastic-id-card-holder-500x500",
        "inventory_code": "S1011",
        "description": "student-plastic-id-card-holder-500x500",
        "is_dress": "0",
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg",
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg"
        ],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
      {
        "category": "Stationery",
        "item_name": "student-plastic-id-card-holder-500x500",
        "inventory_code": "S1011",
        "description": "student-plastic-id-card-holder-500x500",
        "is_dress": 1,
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg",
          "http://124.217.235.107:2008/FS/StoreItems/4adc-e4c2-2021-11-25-11-32-55-924/student-plastic-id-card-holder-500x500.jpg"
        ],
        "colors": ["White", "Black", "Red", "Blue"],
        "size": ["S", "M", "L", "XL", "XXL"],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
      {
        "category": "Stationery",
        "item_name": "Color Box",
        "inventory_code": "S1011",
        "description": "student-plastic-id-card-holder-500x500",
        "is_dress": "0",
        "price": "10.00",
        "discount": "5%",
        "available_quantity": 50,
        "applicable_group": "All",
        "image": [],
        "merchantimage":
            "http://124.217.235.107:2008/FS/Merchant/1569-e4c2-2021-11-25-10-18-28-567/CALMS_Technologies_Sdn_Bhd_Logo.png"
      },
    ];
  }

  @override
  _StoresState createState() => _StoresState();
}

class _StoresState extends State<Stores> {
  @override
  void initState() {
    _foundStoreList = widget.getStoreList();
    super.initState();
  }

  // This function is called whenever the text field changes
  void _runFilter(String enteredKeyword) {
    List<Map<dynamic, dynamic>> results = [];
    if (enteredKeyword.isEmpty) {
      // if the search field is empty or only contains white-space, we'll display all users
      results = widget.getStoreList();
    } else {
      results = widget
          .getStoreList()
          .where((user) => user["item_name"]
              .toLowerCase()
              .contains(enteredKeyword.toLowerCase()))
          .toList();
      // we use the toLowerCase() method to make it case-insensitive
    }

    // Refresh the UI
    setState(() {
      _foundStoreList = results;
    });
  }

  List<Map<dynamic, dynamic>> _foundStoreList = [];
  @override
  Widget build(BuildContext context) {
    return Scaffold(
        appBar: AppBar(
          title: Text("Stores"),
        ),
        body: Container(
          child: Column(
            children: [
              Container(
                margin: EdgeInsets.symmetric(vertical: 5, horizontal: 10),
                child: TextField(
                  onChanged: (value) => _runFilter(value),
                  decoration: const InputDecoration(
                      enabledBorder: OutlineInputBorder(
                        borderSide:
                            const BorderSide(color: Colors.blue, width: 2.0),
                      ),
                      focusedBorder: OutlineInputBorder(
                        borderSide:
                            const BorderSide(color: Colors.blue, width: 2.0),
                      ),
                      labelText: 'Search',
                      hintText: 'Type here to search',
                      suffixIcon: Icon(
                        Icons.search,
                        color: Colors.blue,
                      )),
                ),
              ),
              Expanded(
                child: Container(
                  width: double.infinity,
                  margin: EdgeInsets.zero,
                  padding: EdgeInsets.zero,
                  child: ListView.builder(
                      padding: EdgeInsets.zero,
                      shrinkWrap: true,
                      physics: BouncingScrollPhysics(
                          parent: AlwaysScrollableScrollPhysics()),
                      itemCount: _foundStoreList.length,
                      itemBuilder: (BuildContext context, int index) {
                        return Column(children: <Widget>[
                          new Divider(
                            height: 0.1,
                          ),
                          ListTile(
                            leading: ClipRRect(
                              borderRadius: BorderRadius.only(
                                topLeft: Radius.circular(8.0),
                                topRight: Radius.circular(8.0),
                                bottomLeft: Radius.circular(8.0),
                                bottomRight: Radius.circular(8.0),
                              ),
                              child: _foundStoreList[index]['image'].length > 0
                                  ? Image.network(
                                      _foundStoreList[index]['image'][0],
                                      // width: 300,
                                      height: 100,
                                      fit: BoxFit.fill)
                                  : Image.asset("images/user.png"),
                            ),
                            title: Text(
                              _foundStoreList[index]['item_name'],
                              overflow: TextOverflow.ellipsis,
                              style: TextStyle(
                                  fontWeight: FontWeight.bold, fontSize: 14),
                            ),
                            subtitle: Column(
                              crossAxisAlignment: CrossAxisAlignment.start,
                              children: [
                                Text(
                                  _foundStoreList[index]["description"],
                                  overflow: TextOverflow.ellipsis,
                                  maxLines: 2,
                                  style: TextStyle(),
                                ),
                                SizedBox(
                                  height: 5,
                                ),
                                new RichText(
                                  text: new TextSpan(
                                    text: '',
                                    style: new TextStyle(
                                      fontSize: 12.0,
                                    ),
                                    children: <TextSpan>[
                                      new TextSpan(
                                          text:
                                              'MYR ${double.parse(_foundStoreList[index]["price"]).toStringAsFixed(2)}',
                                          style: new TextStyle(
                                              color: Colors.red,
                                              decorationColor: Colors.red,
                                              decorationStyle:
                                                  TextDecorationStyle.solid,
                                              decoration:
                                                  TextDecoration.lineThrough,
                                              fontSize: 12,
                                              fontWeight: FontWeight.bold)),
                                      new TextSpan(
                                          text:
                                              ' (${_foundStoreList[index]['discount']} Off) ',
                                          style: new TextStyle(
                                              fontSize: 12,
                                              color: Colors.black,
                                              fontWeight: FontWeight.bold)),
                                      new TextSpan(
                                          text:
                                              'MYR ${double.parse(_foundStoreList[index]["price"]).toStringAsFixed(2)}',
                                          style: new TextStyle(
                                              fontSize: 12,
                                              fontWeight: FontWeight.bold,
                                              color: Colors.green)),
                                    ],
                                  ),
                                ),
                                SizedBox(
                                  height: 5,
                                ),
                              ],
                            ),
                            isThreeLine: true,
                            trailing: Column(
                              children: [
                                SizedBox(
                                  height: 25,
                                  width: 80,
                                  child: ElevatedButton(
                                    style: ElevatedButton.styleFrom(
                                        primary: Colors.red,
                                        padding: EdgeInsets.zero),
                                    onPressed: () => {},
                                    child: Text(
                                      'Qty ${_foundStoreList[index]['available_quantity']?.toString() ?? _foundStoreList[index]['available_quantity']}',
                                    ),
                                  ),
                                ),
                                SizedBox(
                                  height: 6,
                                ),
                                SizedBox(
                                  height: 25,
                                  width: 25,
                                  child: ClipOval(
                                    child: Material(
                                      color: Colors.transparent, // Button color
                                      child: InkWell(
                                        splashColor: Colors.red, // Splash color
                                        onTap: () {},
                                        child: Icon(
                                          Icons.shopping_cart_outlined,
                                          color: Theme.of(context).primaryColor,
                                          size: 18,
                                        ),
                                      ),
                                    ),
                                  ),
                                ),
                              ],
                            ),
                            onTap: () => {
                              moveToDetails(_foundStoreList, index, context)
                            },
                          )
                        ]);
                      }),
                ),
              ),
            ],
          ),
        ));
  }
}

void moveToDetails(_foundStoreList, index, context) {
  Navigator.of(context)
      .pushNamed('/StoreDetails', arguments: _foundStoreList[index]);
}
